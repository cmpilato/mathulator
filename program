#!/usr/bin/env python
#
# Copyright (c) 2015-2016 C. Michael Pilato
# See LICENSE file for further details.
#
import sys
import os
import re
sys.path.insert(0, 'lib')
import helpers

_re_integer = re.compile('^[0-9]+$')

last_answer = None
while True:
    try:
        input = raw_input("Enter an expression (use spaces): ").strip()
    except (KeyboardInterrupt, EOFError):
        print 
        input = None
    if not input:
        break
    pieces = filter(None, input.split())
    if len(pieces) != 3:
        print "Bogus expression (wrong number of pieces)."
        continue
    op = pieces[1]
    float_needed = False
    if (op in '/'):
        float_needed = True
    arg1 = pieces[0]
    arg2 = pieces[2]
    if (arg1 == '#' or arg2 == '#') and (last_answer is None):
        print "Unable to use previous answer -- there is none!"
        continue
    if arg1 == '#':
        arg1 = str(last_answer)
    if arg2 == '#':
        arg2 = str(last_answer)
    try:
        if not float_needed \
           and _re_integer.match(arg1) \
           and _re_integer.match(arg2):
            arg1 = int(arg1)
            arg2 = int(arg2)
        else:
            arg1 = float(arg1)
            arg2 = float(arg2)
    except:
        print "Non-numerical operands."
        continue
    answer = None
    if op == '-':
        answer = helpers.subtract(arg1, arg2)
    elif op == '+':
        answer = helpers.add(arg1, arg2)
    elif op == '*':
        answer = helpers.multiply(arg1, arg2)
    elif op == '/':
        answer = helpers.divide(arg1, arg2)
    elif op == '%':
        answer = helpers.modulo(arg1, arg2)
    elif op == '^':
        answer = helpers.power(arg1, arg2)

    if answer is not None:
        print answer
        last_answer = answer
    else:
        print "Unknown operator."
  
